const d={};(()=>{const B=(e,t)=>{t.initHalfFloatRGBATexture(t.width,t.height),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)},U=(e,t)=>{if(console.warn("shader-web-background cannot shade, adding fallback CSS classes"),document.documentElement.classList.add("shader-web-background-fallback"),t.classList.add("shader-web-background-fallback"),e instanceof d.GlError)console.warn("Not sufficient WebGL support:",e);else throw e};function T(e,t){if(!e)throw new d.ConfigError(t)}function L(e){return T(e instanceof HTMLCanvasElement,"config.canvas must be instance of canvas"),e}function C(){const e=document.createElement("canvas"),t=e.style;return e.id="shader-web-background",t.width="100vw",t.height="100vh",t.position="fixed",t.top="0",t.left="0",t.zIndex=-9999,e}function _(e,t,r){T(e instanceof HTMLScriptElement&&e.type===t,'Shader source element of id "'+r+'" should be of type: <script type="'+(t+'" id="'+r+'">'))}function D(e){const t=document.getElementById(e);return T(t,'Missing shader source: <script type="x-shader/x-fragment" id="'+(e+'">')),_(t,"x-shader/x-fragment",e),t.text}function P(e){e+="Vertex";const t=document.getElementById(e);return t?(_(t,"x-shader/x-vertex",e),t.text):"attribute vec2 V;void main(){gl_Position=vec4(V,0,1);}"}function b(e,t){document.readyState!=="loading"?t():window.addEventListener(e,t)}class X{constructor(t,r,n,o){this.g=n;const u=t.gl;this.h=()=>{for(const h of o)h.u(u,h.location,r)},this.i=()=>{var h=n.v,i=t.gl;for(i.bindBuffer(i.ARRAY_BUFFER,t.j),i.enableVertexAttribArray(h),i.vertexAttribPointer(h,2,i.FLOAT,!1,0,0),i.drawArrays(i.TRIANGLE_STRIP,0,4),i.disableVertexAttribArray(h),i.bindBuffer(i.ARRAY_BUFFER,null),h=t.gl,i=0;i<t.g;i++)h.activeTexture(h.TEXTURE0+i),h.bindTexture(h.TEXTURE_2D,null);t.g=0}}}function y(e){var t={antialias:!1,depth:!1,alpha:!1};try{return new N(e,t)}catch(r){throw new d.GlError(r.message)}}function M(e,t,r,n,o,u){function h(s,l,g){try{{var a=i;const f=a.gl,Y=p(a,s,f.VERTEX_SHADER,l),z=p(a,s,f.FRAGMENT_SHADER,g),m=f.createProgram();f.attachShader(m,Y),f.attachShader(m,z),f.linkProgram(m);var E=m}return E}catch(f){throw new d.ConfigError(f.message)}}const i=y(e),A=[],c={gl:i.gl,canvas:e,width:0,height:0,cssPixelRatio:0,cssWidth:0,cssHeight:0,isOverShader:(s,l)=>{const g=e.getBoundingClientRect();return s>=g.left&&s<=g.right&&l>=g.top&&l<=g.bottom},toShaderX:s=>(s-e.getBoundingClientRect().left)*c.cssPixelRatio+.5,toShaderY:s=>e.height-(s-e.getBoundingClientRect().top)*c.cssPixelRatio-.5,s:()=>c.cssWidth!==e.clientWidth||c.cssHeight!==e.clientHeight?(c.resize(),!0):!1,resize:()=>{const s=window.devicePixelRatio||1,l=e.clientWidth,g=e.clientHeight,a=Math.floor(l*s),E=Math.floor(g*s);e.width=a,e.height=E,c.width=a,c.height=E,c.cssPixelRatio=s,c.cssWidth=l,c.cssHeight=g,i.gl.viewport(0,0,i.canvas.width,i.canvas.height);for(const f of A)f.g.l(a,E)},texture:(s,l)=>{{var g=i;const a=g.gl;l=l instanceof v?l.g:l,a.activeTexture(a.TEXTURE0+g.g),a.bindTexture(a.TEXTURE_2D,l),a.uniform1i(s,g.g++)}},buffers:{},initHalfFloatRGBATexture:(s,l)=>{i.h.g(s,l)}},j=Object.keys(t).length-1;let V=0;for(const s in t){if(V++<j){const a=t[s].texture||B;c.buffers[s]=H(i,()=>{a(i.gl,c)})}const l=W(i,h(s,P(s),D(s)),c.buffers[s]),g=t[s].uniforms||{};var R=Object.keys(g);for(const a of l.m)T(g[a.name],'No configuration for uniform "'+a.name+'" defined in shader "'+s+'"'),R=R.filter(E=>E!==a.name);R.length!==0&&console.warn('Extra uniforms configured for shader "'+s+'", which are not present in the shader code - might have been removed by GLSL compiler if not used: '+R.join(", ")),R=l.m.map(a=>({location:a.location,u:g[a.name]})),A.push(new X(i,c,l,R))}const S=()=>{c.s()&&n&&n(c.width,c.height,c),o&&o(c);for(const s of A)s.g.i(s.h,s.i);u&&u(c),requestAnimationFrame(S)};return b("load",()=>{c.resize(),r&&r(c),n&&n(c.width,c.height,c),requestAnimationFrame(S)}),c}d.Error=class extends Error{constructor(e){super(e),this.name="shaderWebBackground.Error"}},d.ConfigError=class extends d.Error{constructor(e){super(e),this.name="shaderWebBackground.ConfigError"}},d.GlError=class extends d.Error{constructor(e){super(e),this.name="shaderWebBackground.GlError"}},d.shade=function(e){T(e,"Missing config argument");const t=e.canvas?L(e.canvas):C();T(e.shaders,"No shaders specified in config");try{const r=M(t,e.shaders,e.onInit,e.onResize,e.onBeforeFrame,e.onAfterFrame);return e.canvas||b("DOMContentLoaded",()=>{document.body.appendChild(t)}),r}catch(r){(e.onError||U)(r,t)}};const O=[-1,1,1,1,-1,-1,1,-1];function x(e,t){return e.j(e.gl.getExtension(t),t+" extension is not supported")}class F{constructor(t,r){this.gl=t,this.j=r}g(){}}class I extends F{constructor(t,r){super(t,r),this.h=x(this,"OES_texture_half_float"),x(this,"OES_texture_half_float_linear")}g(t,r){const n=this.gl;n.texImage2D(n.TEXTURE_2D,0,n.RGBA,t,r,0,n.RGBA,this.h.HALF_FLOAT_OES,null)}}class G extends F{constructor(t,r){super(t,r),x(this,"EXT_color_buffer_float"),this.gl.getExtension("OES_texture_float_linear")}g(t,r){const n=this.gl;n.texImage2D(n.TEXTURE_2D,0,n.RGBA16F,t,r,0,n.RGBA,n.HALF_FLOAT,null)}}function k(e){e=e.split(/\r?\n/);const t=e.length.toString().length;var r=[];return e.forEach((n,o)=>{o=(o+1).toString(),o=o.length>=t?o:" ".repeat(t-o.length)+o,r.push(o+": "+n+`
`)}),r.join("")}function H(e,t){return new v(e.gl,()=>{t(e.gl)})}function W(e,t,r){const n=e.gl;e=[];const o=n.getProgramParameter(t,n.ACTIVE_UNIFORMS);for(let u=0;u<o;u++){const h=n.getActiveUniform(t,u);e.push({name:h.name,location:n.getUniformLocation(t,h.name)})}return{v:n.getAttribLocation(t,"V"),m:e,l:r?(u,h)=>r.l(u,h):()=>{},i:(u,h)=>{n.useProgram(t),u(),r?(u=r.g,r.g=r.h,r.h=u,r.i(h)):h()}}}function p(e,t,r,n){if(e=e.gl,r=e.createShader(r),e.shaderSource(r,n),e.compileShader(r),!e.getShaderParameter(r,e.COMPILE_STATUS)){const o=String(e.getShaderInfoLog(r));throw e.deleteShader(r),t="Cannot compile shader - "+t+": "+o,console.log(t),console.log(k(n)),Error(t)}return r}class N{constructor(t,r){this.canvas=t;const n=(u,h)=>{if(!u)throw Error(h);return u};let o=t.getContext("webgl2",r);o?this.h=new G(o,n):(o=t.getContext("webgl",r))&&(this.h=new I(o,n)),n(o,"webgl context not supported on supplied canvas element: "+t),this.gl=o,t=o.createBuffer(),o.bindBuffer(o.ARRAY_BUFFER,t),o.bufferData(o.ARRAY_BUFFER,new Float32Array(O),o.STATIC_DRAW),o.bindBuffer(o.ARRAY_BUFFER,null),this.j=t,this.buffers={},this.g=0}}function w(e){const t=e.gl,r=t.createTexture();return t.bindTexture(t.TEXTURE_2D,r),e.o(t),t.bindTexture(t.TEXTURE_2D,null),r}class v{constructor(t,r){this.j=t.createFramebuffer(),this.gl=t,this.o=r,this.g=this.h=null}l(){this.h&&this.gl.deleteTexture(this.h),this.g&&this.gl.deleteTexture(this.g),this.h=w(this),this.g=w(this)}i(t){const r=this.gl;r.bindFramebuffer(r.FRAMEBUFFER,this.j),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,this.g,0),t(),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,null,0),r.bindFramebuffer(r.FRAMEBUFFER,null)}}})();var q={shaderWebBackground:d};export{q as s};
